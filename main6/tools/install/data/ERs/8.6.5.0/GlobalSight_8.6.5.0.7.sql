## GBS-3564: Multiple Choice (Choice List) attribute values not all written back to TM.

## Create a backup table to store old data, this table will not be refered by codes.
CREATE TABLE TM_PROFILE_ATTRIBUTE_ABANDONED (
  `ID` BIGINT AUTO_INCREMENT PRIMARY KEY,
  `TMP_ID` BIGINT NOT NULL,
  `ATT_NAME` VARCHAR(100) NOT NULL,
  `OPERATOR` VARCHAR(100) NOT NULL,
  `VALUE_TYPE` VARCHAR(100) NOT NULL,
  `VALUE_DATA` VARCHAR(100) NULL,
  `PENALTY` INT(11) NOT NULL
);

## Backup data from "tm_profile_attribute" table.
INSERT INTO TM_PROFILE_ATTRIBUTE_ABANDONED (ID, TMP_ID, ATT_NAME, OPERATOR, VALUE_TYPE, VALUE_DATA, PENALTY)
SELECT ID, TMP_ID, ATT_NAME, OPERATOR, VALUE_TYPE, VALUE_DATA, PENALTY FROM TM_PROFILE_ATTRIBUTE;

## drop old then re-create a schema changed table.
DROP TABLE TM_PROFILE_ATTRIBUTE;

CREATE TABLE TM_PROFILE_ATTRIBUTE (
  ID BIGINT AUTO_INCREMENT PRIMARY KEY,
  TMP_ID BIGINT NOT NULL,
  ATT_NAME VARCHAR(100) NOT NULL,
  OPERATOR VARCHAR(100) NOT NULL,
  VALUE_TYPE VARCHAR(100) NOT NULL,
  VALUE_DATA VARCHAR(100) NULL,
  AND_OR VARCHAR(12) NOT NULL,
  PRIORITY_ORDER INT(2) NOT NULL
);

ALTER TABLE tm_profile ADD COLUMN CHOICE_IF_ATT_NOT_MATCH VARCHAR(20);
ALTER TABLE tm_profile ADD COLUMN TU_ATT_NOT_MATCH_PENALTY INT(11) DEFAULT 1;
